{extend name="./template/zymk/m/pub/base.html" /}
{block name="seo"}
<title>漫画更新记录_最新漫画更新列表_最新漫画推荐-{$site_name}</title>
{/block}
{block name="css"}
<link rel="stylesheet" href="/template/zymk/css/entry.update.css">
{/block}
{block name="content"}
<section class="mk-container" id="app">
    <section class="view-port view-flex" id="J_updateViewPort">
        <div class="mk-container mk-sort">
            <header class="mk-header fixed">
                <div class="left">
                    <a href="/" title="首页"><i class="back ift-goback"></i><a></a></a></div>
                <a></a>
                <h1 class="title">最新漫画</h1>
            </header>
            <div id="J_updateHeader"
                 class="view-header swiper-container gallery-thumbs date-bar swiper-container-horizontal">
                <ul class="swiper-wrapper bar-list"
                    style="transform: translate3d(-720px, 0px, 0px); transition-duration: 0ms;">
                    <li v-for="(item, index) in days" :key="index" class="swiper-slide" style="width: 120px;"
                        :class="{'swiper-slide-active' : day==item.day}" @click="switchTab(item.day, item.date)">
                        <span class="date-item">
                          {{item.name}}
                        </span>
                    </li>
                </ul>
            </div>
            <div class="blank88"></div>
            <div class="bd">
                <ul class="comic-sort">
                    <li class="item" v-for="(item, index) in books" :key="index">
                        <div class="comic-item">
                            <div class="thumbnail">
                                <a :href="'/{$book_ctrl}/'+ item.param" :title="item.book_name">
                                    <img src="https://ae01.alicdn.com/kf/He3cda13f34d44e8fb85dcdf6c7768398F.gif"
                                         :data-src="item.cover_url" :alt="item.book_name"/>
                                    <span class="chapter">
                                        {{item.summary}}
                                    </span>
                                    <span class="ift-xing score">9.8</span>
                                </a>
                            </div>
                            <h3 class="title">
                                <a :href="'/{$book_ctrl}/'+ item.param" :title="item.book_name">{{item.book_name}}</a>
                            </h3>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </section>
</section>
{/block}
{block name="js"}
{if $cdn == 'bootcdn'}
<script src="https://cdn.bootcss.com/moment.js/2.24.0/moment.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.24.0/locale/zh-cn.js"></script>
{else /}
<script src="https://lib.baomitu.com/moment.js/2.24.0/moment.min.js"></script>
<script src="https://lib.baomitu.com/moment.js/2.24.0/locale/zh-cn.js"></script>
{/if}
<script>
    var app = new Vue({
        el: '#app',
        data: {
            books: [],
            days: [],
            day: -1,
            date: '1970-01-01',
            page: 0,
            isMore: 1
        },
        methods: {
            getBooks(isRefresh) {
                axios.get("/getUpdate", {
                    params: {
                        page: this.page,
                        date: this.date
                    }
                }).then(response => {
                    if (isRefresh == 1) { //为1是重新渲染
                        this.books = response.data.books
                        this.isMore = 1
                    } else {
                        if (response.data.err == 1) {
                            this.isMore = 0 //设置好之后，上拉加载就不再请求接口了
                            __global.layerMsg('没有更多了')
                        } else {
                            this.books = this.books.concat(response.data.books)
                        }
                    }
                })
            },
            switchTab(day, date) {
                this.day = day
                this.date = date
                this.getBooks(1)
            },
            onScroll() {                    //可滚动容器的高度
                var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                //变量windowHeight是可视区的高度
                var windowHeight = document.documentElement.clientHeight || document.body.clientHeight;
                //变量scrollHeight是滚动条的总高度
                var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
                //滚动条到底部的条件
                if (scrollTop + windowHeight == scrollHeight) {
                    if (this.isMore == 1) { //如果还有更多数据，再请求接口，否则不再请求，节省服务器资源
                        this.getBooks(0)
                        this.page = this.page + 15
                    }
                }
            }
        },
        mounted() {
            for (let i = 0; i <= 6; i++) {
                this.days.push({
                    day: i,
                    date: moment().subtract(i, 'days').format('YYYY-MM-DD'),
                    name: moment().subtract(i, 'days').format('dddd').replace('星期', '周')
                })
            }
            this.getBooks(1)
        },
        created() {
            window.addEventListener('scroll', this.onScroll);
        }
    })
</script>
{/block}